<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Usage Examples &mdash; FaKnow 0.0.1 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Config Introduction" href="../user_guide/config_intro.html" />
    <link rel="prev" title="Installation" href="installation.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            FaKnow
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">get started:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Usage Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#quick-start">Quick Start</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#run">run</a></li>
<li class="toctree-l3"><a class="reference internal" href="#run-specific-models">run specific models</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#run-from-scratch">Run From Scratch</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User Guide:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/config_intro.html">Config Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/data_intro.html">Data Module Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/model_intro.html">Model Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/train_eval_intro.html">Training &amp; Evaluation Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/usage.html">Usage</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Guide:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../developer_guide/customize_models.html">Customize Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer_guide/customize_trainers.html">Customize Trainers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer_guide/customize_dataloaders.html">Customize DataLoaders</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API REFERENCE:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../faknow/faknow.config.html">faknow.config</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faknow/faknow.data.html">faknow.data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faknow/faknow.evaluate.html">faknow.evaluate</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faknow/faknow.model.html">faknow.model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faknow/faknow.run.html">faknow.run</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faknow/faknow.train.html">faknow.train</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faknow/faknow.utils.html">faknow.utils</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">FaKnow</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Usage Examples</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/get_started/usage_example.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="usage-examples">
<h1>Usage Examples<a class="headerlink" href="#usage-examples" title="Permalink to this heading"></a></h1>
<section id="quick-start">
<h2>Quick Start<a class="headerlink" href="#quick-start" title="Permalink to this heading"></a></h2>
<p>We provide several methods to <strong>run integrated models</strong> quickly with passing only few arguments. For hyper parameters
like learning rate, values from the open source code of the paper are taken as default. You can also passing your own
defined hyper parameters to these methods.</p>
<section id="run">
<h3>run<a class="headerlink" href="#run" title="Permalink to this heading"></a></h3>
<p>You can use <code class="docutils literal notranslate"><span class="pre">run</span></code> and <code class="docutils literal notranslate"><span class="pre">run_from_yaml</span></code> methods to run integrated models. The former receives the parameters as <code class="docutils literal notranslate"><span class="pre">dict</span></code>
keyword arguments and the latter reads them from the <code class="docutils literal notranslate"><span class="pre">yaml</span></code> configuration file.</p>
<ul class="simple">
<li><p>run from kargs</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">faknow.run</span> <span class="kn">import</span> <span class="n">run</span>

<span class="n">model</span> <span class="o">=</span> <span class="s1">&#39;mdfend&#39;</span>  <span class="c1"># lowercase short name of models</span>
<span class="n">kargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;train_path&#39;</span><span class="p">:</span> <span class="s1">&#39;train.json&#39;</span><span class="p">,</span> <span class="s1">&#39;test_path&#39;</span><span class="p">:</span> <span class="s1">&#39;test.json&#39;</span><span class="p">}</span>  <span class="c1"># dict arguments</span>
<span class="n">run</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
</pre></div>
</div>
<p>the json file for <em>mdfend</em> should be like:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;text&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;this is a sentence.&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;domain&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">9</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;text&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;this is a sentence.&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;domain&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<ul class="simple">
<li><p>run from yaml</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># demo.py</span>
<span class="kn">from</span> <span class="nn">faknow.run</span> <span class="kn">import</span> <span class="n">run_from_yaml</span>

<span class="n">model</span> <span class="o">=</span> <span class="s1">&#39;mdfend&#39;</span>  <span class="c1"># lowercase short name of models</span>
<span class="n">config_path</span> <span class="o">=</span> <span class="s1">&#39;mdfend.yaml&#39;</span>  <span class="c1"># config file path</span>
<span class="n">run_from_yaml</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">config_path</span><span class="p">)</span>
</pre></div>
</div>
<p>your yaml config file should be like:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># mdfend.yaml</span>
<span class="nt">train_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">train.json</span><span class="w"> </span><span class="c1"># the path of training set file</span>
<span class="nt">test_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test.json</span><span class="w"> </span><span class="c1"># the path of testing set file</span>
</pre></div>
</div>
</section>
<section id="run-specific-models">
<h3>run specific models<a class="headerlink" href="#run-specific-models" title="Permalink to this heading"></a></h3>
<p>You can also run specific models using <code class="docutils literal notranslate"><span class="pre">run_model</span></code> and <code class="docutils literal notranslate"><span class="pre">run_model_from_yaml</span></code> methods by passing paramter, where <code class="docutils literal notranslate"><span class="pre">model</span></code>
is the short name of the integrated model you want to use. The usages are the same as <code class="docutils literal notranslate"><span class="pre">run</span></code> and <code class="docutils literal notranslate"><span class="pre">run_from_yaml</span></code>.
Following is an example to run <em>mdfend</em>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">faknow.run.content_based.run_mdfend</span> <span class="kn">import</span> <span class="n">run_mdfend</span><span class="p">,</span> <span class="n">run_mdfend_from_yaml</span>

<span class="c1"># run from kargs</span>
<span class="n">kargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;train_path&#39;</span><span class="p">:</span> <span class="s1">&#39;train.json&#39;</span><span class="p">,</span> <span class="s1">&#39;test_path&#39;</span><span class="p">:</span> <span class="s1">&#39;test.json&#39;</span><span class="p">}</span>  <span class="c1"># dict training arguments</span>
<span class="n">run_mdfend</span><span class="p">(</span><span class="o">**</span><span class="n">kargs</span><span class="p">)</span>

<span class="c1"># or run from yaml</span>
<span class="n">config_path</span> <span class="o">=</span> <span class="s1">&#39;mdfend.yaml&#39;</span>  <span class="c1"># config file path</span>
<span class="n">run_mdfend_from_yaml</span><span class="p">(</span><span class="n">config_path</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="run-from-scratch">
<h2>Run From Scratch<a class="headerlink" href="#run-from-scratch" title="Permalink to this heading"></a></h2>
<p>Following is an example to run <em>mdfend</em> from scratch.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">faknow.data.dataset.text</span> <span class="kn">import</span> <span class="n">TextDataset</span>
<span class="kn">from</span> <span class="nn">faknow.evaluate.evaluator</span> <span class="kn">import</span> <span class="n">Evaluator</span>
<span class="kn">from</span> <span class="nn">faknow.model.content_based.mdfend</span> <span class="kn">import</span> <span class="n">MDFEND</span>
<span class="kn">from</span> <span class="nn">faknow.train.trainer</span> <span class="kn">import</span> <span class="n">BaseTrainer</span>
<span class="kn">from</span> <span class="nn">faknow.run.content_based</span> <span class="kn">import</span> <span class="n">TokenizerMDFEND</span>

<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">torch.utils.data</span> <span class="kn">import</span> <span class="n">DataLoader</span>

<span class="c1"># tokenizer for MDFEND</span>
<span class="n">max_len</span><span class="p">,</span> <span class="n">bert</span> <span class="o">=</span> <span class="mi">170</span><span class="p">,</span> <span class="s1">&#39;bert-base-uncased&#39;</span>
<span class="n">tokenizer</span> <span class="o">=</span> <span class="n">TokenizerMDFEND</span><span class="p">(</span><span class="n">max_len</span><span class="p">,</span> <span class="n">bert</span><span class="p">)</span>

<span class="c1"># dataset</span>
<span class="n">batch_size</span> <span class="o">=</span> <span class="mi">64</span>
<span class="n">train_path</span><span class="p">,</span> <span class="n">test_path</span><span class="p">,</span> <span class="n">validate_path</span> <span class="o">=</span> <span class="s1">&#39;train.json&#39;</span><span class="p">,</span> <span class="s1">&#39;test.json&#39;</span><span class="p">,</span> <span class="s1">&#39;val.json&#39;</span>

<span class="n">train_set</span> <span class="o">=</span> <span class="n">TextDataset</span><span class="p">(</span><span class="n">train_path</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">],</span> <span class="n">tokenizer</span><span class="p">)</span>
<span class="n">train_loader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">train_set</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">validate_set</span> <span class="o">=</span> <span class="n">TextDataset</span><span class="p">(</span><span class="n">validate_path</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">],</span> <span class="n">tokenizer</span><span class="p">)</span>
<span class="n">val_loader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">validate_set</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">test_set</span> <span class="o">=</span> <span class="n">TextDataset</span><span class="p">(</span><span class="n">test_path</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">],</span> <span class="n">tokenizer</span><span class="p">)</span>
<span class="n">tset_loader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">test_set</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># prepare model</span>
<span class="n">domain_num</span> <span class="o">=</span> <span class="mi">9</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">MDFEND</span><span class="p">(</span><span class="n">bert</span><span class="p">,</span> <span class="n">domain_num</span><span class="p">)</span>

<span class="c1"># optimizer and lr scheduler</span>
<span class="n">lr</span><span class="p">,</span> <span class="n">weight_decay</span><span class="p">,</span> <span class="n">step_size</span><span class="p">,</span> <span class="n">gamma</span> <span class="o">=</span> <span class="mf">0.00005</span><span class="p">,</span> <span class="mf">5e-5</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.98</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span>
                             <span class="n">lr</span><span class="o">=</span><span class="n">lr</span><span class="p">,</span>
                             <span class="n">weight_decay</span><span class="o">=</span><span class="n">weight_decay</span><span class="p">)</span>
<span class="n">scheduler</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">lr_scheduler</span><span class="o">.</span><span class="n">StepLR</span><span class="p">(</span><span class="n">optimizer</span><span class="p">,</span> <span class="n">step_size</span><span class="p">,</span> <span class="n">gamma</span><span class="p">)</span>

<span class="c1"># metrics to evaluate the model performance</span>
<span class="n">evaluator</span> <span class="o">=</span> <span class="n">Evaluator</span><span class="p">()</span>

<span class="c1"># train and validate</span>
<span class="n">num_epochs</span><span class="p">,</span> <span class="n">device</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="s1">&#39;cpu&#39;</span>
<span class="n">trainer</span> <span class="o">=</span> <span class="n">BaseTrainer</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">evaluator</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">,</span> <span class="n">scheduler</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
<span class="n">trainer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_loader</span><span class="p">,</span> <span class="n">num_epochs</span><span class="p">,</span> <span class="n">validate_loader</span><span class="o">=</span><span class="n">val_loader</span><span class="p">)</span>

<span class="c1"># show test result</span>
<span class="nb">print</span><span class="p">(</span><span class="n">trainer</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">test_loader</span><span class="p">))</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="installation.html" class="btn btn-neutral float-left" title="Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../user_guide/config_intro.html" class="btn btn-neutral float-right" title="Config Introduction" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, NPURG.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>